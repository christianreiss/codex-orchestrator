<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Codex-Coordinator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
	  <link rel="stylesheet" href="/admin/assets/dashboard.css?v=2025-12-12-01">
	  <link rel="stylesheet" href="/admin/assets/dashboard-mobile.css?v=2025-12-12-01">
</head>
<body data-view="desktop" data-view-mode="dashboard">
  <header class="main-nav">
    <div class="nav-brand">
      <img class="brand-logo" src="/admin/assets/openai-logo.svg" alt="OpenAI logo">
      <div>
        <div class="brand-title">Codex Coordinator</div>
      </div>
    </div>
    <nav class="nav-groups">
      <a class="nav-item" href="#dashboard" data-nav="dashboard">Dashboard</a>
      <a class="nav-item" href="#hosts" data-nav="hosts">Hosts</a>
      <a class="nav-item" href="#logs" data-nav="logs">Logs</a>
      <a class="nav-item" href="#settings" data-nav="settings">Settings</a>
    </nav>
    <div class="nav-status">
      <span class="status-chip" id="mtlsStatus">mTLS: checking…</span>
    </div>
    <div class="nav-actions">
      <button class="nav-btn primary" id="navInsecureHosts" style="display:none;">Toggler</button>
      <button class="nav-btn primary" id="navNewHost">New host</button>
    </div>
  </header>

  <div class="app">
    <div class="content">
      <nav class="menu-line" aria-label="Top navigation">
        <a class="menu-link" href="#dashboard">Overview</a>
        <a class="menu-link" href="#hosts">Hosts</a>
        <a class="menu-link" href="#logs">Logs</a>
        <a class="menu-link" href="#settings">Settings</a>
      </nav>

      <main class="main">
        <!-- Modals (from legacy hosts/settings) -->
        <div class="modal-backdrop" id="seedModal">
          <div class="modal seed-modal">
            <h3>Initial seeding required</h3>
            <p class="muted" id="seedModalCopy">This installation has no hosts or canonical auth.json yet. Seed auth.json before issuing installers.</p>
            <div class="seed-status">
              <div class="seed-chip warn" id="seedHostsStatus"><span class="dot"></span>No hosts registered</div>
              <div class="seed-chip warn" id="seedAuthStatus"><span class="dot"></span>Canonical auth.json missing</div>
            </div>
            <div class="actions">
              <button class="ghost" id="seedDismissBtn">Close</button>
              <button id="seedUploadBtn">Seed auth.json</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="newHostModal">
          <div class="modal">
            <h3>New Host</h3>
            <p>Issue a one-time installer link for this FQDN. The API key is baked in and bound to this host on first contact.</p>
            <div class="field">
              <label for="new-host-name" style="font-weight:600;">Host FQDN</label>
              <input id="new-host-name" type="text" placeholder="e.g. node-01.example.com">
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="secureHostToggle">
                <input type="checkbox" id="secureHostToggle" checked>
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">Secure host (keep auth.json after runs)</span>
              </label>
              <p class="muted" style="margin:6px 0 0;">Off = treat as insecure; cdx removes auth.json after each run.</p>
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="insecureToggle">
                <input type="checkbox" id="insecureToggle">
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">Allow insecure curl (-k)</span>
              </label>
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="ipv4Toggle">
                <input type="checkbox" id="ipv4Toggle">
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">Force IPv4 (curl -4)</span>
              </label>
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="vipToggle">
                <input type="checkbox" id="vipToggle">
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">VIP host (ignore quota kill switch)</span>
              </label>
            </div>
            <div class="field" id="commandField" style="display:none;">
              <label style="font-weight:600;">Run on the target host</label>
              <div class="command-box">
                <span class="cmd-text" id="bootstrapCmd"></span>
                <button class="copy-btn" id="copyCmd">Copy</button>
              </div>
              <p class="muted" id="installerMeta" style="margin-top:8px; display:none;"></p>
              <p class="muted" style="margin-top:8px;">Single command downloads the baked installer and configures the host.</p>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
              <button class="ghost" id="cancelNewHost">Cancel</button>
              <button id="createHost">Generate</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="uploadModal">
          <div class="modal">
            <h3>Seed auth.json</h3>
            <p>Paste or choose an auth.json; it will be validated via the runner and stored as canonical.</p>
            <div class="field">
              <label for="uploadHostSelect" style="font-weight:600;">Store scope</label>
              <select id="uploadHostSelect"></select>
            </div>
            <div class="field">
              <label for="uploadAuthText" style="font-weight:600;">auth.json</label>
              <textarea id="uploadAuthText" rows="8" placeholder='{"last_refresh":"...","auths":{...}}'></textarea>
            </div>
            <div class="field">
              <label style="font-weight:600;">or choose file</label>
              <input type="file" id="uploadAuthFile" accept=".json,application/json">
            </div>
            <div id="uploadStatus" class="muted" style="min-height:18px; font-size:13px;"></div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
              <button class="ghost" id="uploadAuthCancel">Cancel</button>
              <button id="uploadAuthSubmit">Upload</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="insecureHostsModal">
          <div class="modal">
            <h3>Insecure hosts</h3>
            <p class="muted">Enable or disable the insecure API window. Active windows are listed first.</p>
            <div id="insecureHostsList" class="quick-hosts-list"></div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px;">
              <button class="ghost" id="insecureHostsCloseBtn">Close</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="deleteHostModal">
          <div class="modal">
            <h3>Remove host</h3>
            <p id="delete-host-text" class="muted"></p>
            <div class="actions">
              <button class="ghost" id="cancelDeleteHost">Cancel</button>
              <button class="danger" id="confirmDeleteHost">Remove</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="hostDetailModal">
          <div class="modal host-detail-modal">
            <div class="host-detail-head">
              <div>
                <p class="muted overline">Authorized Host</p>
                <h3 id="hostDetailTitle">Loading…</h3>
                <div class="chip-row" id="hostDetailPills"></div>
              </div>
              <div class="host-detail-head-actions">
                <button class="ghost tiny-btn" id="closeHostDetail">Close</button>
              </div>
            </div>
            <div class="host-detail-summary" id="hostDetailSummary"></div>
            <div class="kv-grid" id="hostDetailGrid"></div>
            <div class="host-detail-actions" id="hostDetailActions"></div>
          </div>
        </div>
        <div class="modal-backdrop" id="runnerModal">
          <div class="modal">
            <h3>Auth runner</h3>
            <p class="muted">Manual runner invocation with live output and the final decision.</p>
            <div class="runner-meta" id="runnerMeta"></div>
            <div class="runner-log" id="runnerLog" aria-live="polite"></div>
            <div class="actions">
              <button class="ghost" id="runnerClose">Close</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="upgradeModal">
          <div class="modal">
            <h3>Codex Upgrade Notes</h3>
            <p class="muted" id="upgradeVersionLabel"></p>
            <div class="upgrade-notes" id="upgradeNotes">Loading…</div>
            <div class="actions">
              <button class="ghost" id="upgradeGithubLink" type="button">Open on GitHub</button>
            <button class="ghost" id="upgradeClose">Close</button>
          </div>
        </div>
        <div class="modal-backdrop" id="accessBlockModal">
          <div class="modal">
            <h3 id="accessBlockTitle">Admin access blocked</h3>
            <p class="muted" id="accessBlockBody">mTLS is required before continuing.</p>
            <div class="actions" style="margin-top:12px; justify-content:flex-end;">
              <button class="ghost" id="accessBlockDismiss">Close</button>
            </div>
          </div>
        </div>
        </div>
        <div class="modal-backdrop" id="usageHistoryModal">
          <div class="modal usage-history-modal">
            <div class="modal-head">
              <div>
                <h3>ChatGPT Quota Trend</h3>
                <p class="muted" id="usageHistorySubtitle">Loading…</p>
              </div>
              <button class="ghost tiny-btn" id="usageHistoryClose">Close</button>
            </div>
            <div class="usage-history-chart" id="usageHistoryChart">Loading…</div>
            <div class="muted" id="usageHistoryMeta" style="margin-top:8px;"></div>
          </div>
        </div>
        <div class="modal-backdrop" id="costHistoryModal">
          <div class="modal usage-history-modal">
            <div class="modal-head">
              <div>
                <h3>Cost Trend</h3>
                <p class="muted" id="costHistorySubtitle">Loading…</p>
              </div>
              <button class="ghost tiny-btn" id="costHistoryClose">Close</button>
            </div>
            <div class="usage-history-chart cost-history-chart" id="costHistoryChart">Loading…</div>
            <div class="muted" id="costHistoryMeta" style="margin-top:8px;"></div>
          </div>
        </div>

        <!-- Dashboard -->
        <section class="panel-set" data-panel="dashboard">
          <section class="card usage-card" id="chatgpt-usage-card">
            <div class="muted">Loading ChatGPT usage…</div>
          </section>
          <section class="grid metrics" id="stats"></section>
        </section>

        <!-- Hosts -->
        <section class="panel-set" data-panel="hosts" hidden>
          <div class="subtabs host-tabs" role="tablist" aria-label="Hosts tabs">
            <a class="host-tab active" data-host-tab="" href="#hosts">All</a>
            <a class="host-tab" data-host-tab="secure" href="#hosts/secure">Secure</a>
            <a class="host-tab" data-host-tab="insecure" href="#hosts/insecure">Insecure</a>
            <a class="host-tab" data-host-tab="unprovisioned" href="#hosts/unprovisioned">Unprovisioned</a>
          </div>
          <section class="card panel" id="hosts-panel">
            <div class="panel-head">
              <div>
                <h2>Authorized Hosts</h2>
              </div>
              <div class="panel-actions">
                <input type="search" id="host-filter" placeholder="Search host, IP, or version">
              </div>
            </div>
            <div class="table-wrap">
              <table id="hosts">
                <thead>
                  <tr>
                    <th data-sort-key="host"><span class="sort-link" role="button" tabindex="0" data-sort="host"><span>Host</span><span class="sort-indicator">↕</span></span></th>
                    <th data-sort-key="last_seen"><span class="sort-link" role="button" tabindex="0" data-sort="last_seen"><span>Last Seen</span><span class="sort-indicator">↕</span></span></th>
                    <th data-sort-key="client"><span class="sort-link" role="button" tabindex="0" data-sort="client"><span>Client</span><span class="sort-indicator">↕</span></span></th>
                    <th data-sort-key="wrapper"><span class="sort-link" role="button" tabindex="0" data-sort="wrapper"><span>Wrapper</span><span class="sort-indicator">↕</span></span></th>
                    <th data-sort-key="ip"><span class="sort-link" role="button" tabindex="0" data-sort="ip"><span>IP / Mode</span><span class="sort-indicator">↕</span></span></th>
                    <th class="insecure-col">Insecure API</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </section>

        <!-- Logs -->
        <section class="panel-set" data-panel="logs" hidden>
          <div class="subtabs log-tabs" role="tablist" aria-label="Logs tabs">
            <a class="log-tab active" data-log-tab="client" href="#logs/api">API logs</a>
            <a class="log-tab" data-log-tab="mcp" href="#logs/mcp">MCP logs</a>
          </div>
          <section class="card panel log-panel" id="client-logs-panel">
            <div class="panel-head">
              <div>
                <h2>Client Reports</h2>
                <p class="muted" style="margin:4px 0 0;">Newest first · search by host or IP · click headers to sort.</p>
              </div>
              <div class="panel-actions log-actions">
                <input type="search" id="log-search" placeholder="Search host or IP">
                <select id="log-page-size" title="Rows per page">
                  <option value="25">25 / page</option>
                  <option value="50" selected>50 / page</option>
                  <option value="100">100 / page</option>
                </select>
                <button id="log-refresh" class="ghost tiny-btn">↻ Refresh</button>
              </div>
            </div>
            <div class="table-wrap log-table-wrap">
              <table id="log-table">
                <thead>
                  <tr>
                    <th class="sortable" data-sort="created_at">Time</th>
                    <th class="sortable" data-sort="host">Host</th>
                    <th class="sortable" data-sort="client_ip">Client IP</th>
                    <th class="sortable" data-sort="input">Input</th>
                    <th class="sortable" data-sort="output">Output</th>
                    <th class="sortable" data-sort="cached">Cached</th>
                    <th class="sortable" data-sort="reasoning">Reasoning</th>
                    <th class="sortable" data-sort="cost">Cost</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="loading-row"><td colspan="8">Loading…</td></tr>
                </tbody>
              </table>
            </div>
            <div class="log-footer">
              <div id="log-status" class="muted">Loading…</div>
              <div class="log-pagination">
                <button id="page-prev" class="ghost tiny-btn">← Prev</button>
                <div class="page-indicator" id="page-indicator">Page 1 / 1</div>
                <button id="page-next" class="ghost tiny-btn">Next →</button>
              </div>
            </div>
          </section>
          <section class="card panel log-panel" id="mcp-logs-panel" hidden>
            <div class="panel-head">
              <div>
                <h2>MCP Access Logs</h2>
                <p class="muted" style="margin:4px 0 0;">Recent MCP access events.</p>
              </div>
              <div class="panel-actions log-actions">
                <button id="mcp-refresh" class="ghost tiny-btn">↻ Refresh</button>
              </div>
            </div>
            <div class="table-wrap log-table-wrap">
              <table id="mcp-log-table">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Host</th>
                    <th>Tool</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="loading-row"><td colspan="4">Loading…</td></tr>
                </tbody>
              </table>
            </div>
          </section>
        </section>

        <!-- Settings -->
        <section class="panel-set" data-panel="settings" hidden>
          <div class="subtabs settings-tabs" role="tablist" aria-label="Settings tabs">
            <a class="settings-tab active" data-settings-tab="general" href="#settings/general">General</a>
            <a class="settings-tab" data-settings-tab="agents" href="#settings/agents">Agents</a>
            <a class="settings-tab" data-settings-tab="prompts" href="#settings/prompts">Slash commands</a>
            <a class="settings-tab" data-settings-tab="memories" href="#settings/memories">Memories</a>
            <a class="settings-tab" data-settings-tab="config" href="#settings/config">config.toml</a>
          </div>
          <section class="card panel settings-panel" data-settings-panel="general">
            <div class="panel-head">
              <div>
                <h2>Operations & Settings</h2>
                <p class="muted" style="margin:4px 0 0;">Emergency toggles and runner utilities.</p>
              </div>
              <div class="panel-actions">
                <button class="ghost tiny-btn" id="settingsToggle">Show</button>
              </div>
            </div>
            <div class="settings-grid">
              <div class="setting-block">
                <div class="setting-head">
                  <div>
                    <h3>Quota Policy</h3>
                    <p class="muted quota-desc" style="margin:2px 0 0;">ChatGPT quota hit: deny Codex launch.</p>
                  </div>
                  <label class="toggle" for="quotaHardFailToggle">
                    <input type="checkbox" id="quotaHardFailToggle">
                    <span class="track"><span class="thumb"></span></span>
                    <span class="toggle-text" id="quotaModeLabel">Deny launches</span>
                  </label>
                </div>
                <div class="quota-limit-control">
                  <div class="quota-limit-head">
                    <p class="muted" style="margin:0;">Warn/kill at</p>
                    <div class="quota-limit-value" id="quotaLimitLabel">100%</div>
                  </div>
                  <input type="range" min="50" max="100" step="1" value="100" id="quotaLimitSlider" class="quota-limit-slider">
                  <p class="muted quota-limit-foot">Used percent that triggers warnings (or failures when deny mode is on).</p>
                </div>
                <div class="quota-partition-control">
                  <div class="quota-limit-head">
                    <p class="muted" style="margin:0;">Week partition</p>
                    <div class="quota-limit-value" id="quotaPartitionLabel">Off</div>
                  </div>
                  <div class="quota-partition-buttons" role="group" aria-label="Week partition">
                    <button type="button" class="ghost tiny-btn quota-partition-btn" data-days="0" aria-pressed="true">Off</button>
                    <button type="button" class="ghost tiny-btn quota-partition-btn" data-days="7" aria-pressed="false">7 days</button>
                    <button type="button" class="ghost tiny-btn quota-partition-btn" data-days="5" aria-pressed="false">Mon-Fri</button>
                  </div>
                  <p class="muted quota-limit-foot">Adds a daily allowance bar in cdx; honours deny/warn mode.</p>
                </div>
              </div>
              <div class="setting-block">
                <div class="setting-head">
                  <div>
                    <h3>API Kill Switch</h3>
                    <p class="muted" style="margin:2px 0 0;">Emergency stop for Codex agents.</p>
                  </div>
                  <label class="toggle" for="apiToggle">
                    <input type="checkbox" id="apiToggle">
                    <span class="track"><span class="thumb"></span></span>
                    <span class="toggle-text" id="apiToggleLabel">Enabled</span>
                  </label>
                </div>
              </div>
              <div class="setting-block">
                <div class="setting-head">
                  <div>
                    <h3>cdx Silent Mode</h3>
                    <p class="muted" style="margin:2px 0 0;">Hide wrapper boot logs; only errors print.</p>
                  </div>
                  <label class="toggle" for="cdxSilentToggle">
                    <input type="checkbox" id="cdxSilentToggle">
                    <span class="track"><span class="thumb"></span></span>
                    <span class="toggle-text" id="cdxSilentLabel">Verbose</span>
                  </label>
                </div>
              </div>
              <div class="setting-block">
                <div class="setting-head">
                  <div>
                    <h3>Insecure Host Window</h3>
                    <p class="muted" style="margin:2px 0 0;">Duration granted when enabling insecure hosts.</p>
                  </div>
                </div>
                <div class="insecure-window-control">
                  <div class="insecure-window-head">
                    <div>
                      <p class="muted insecure-window-copy">Applies to the next enable and persists locally.</p>
                    </div>
                    <div class="insecure-window-value" id="insecureWindowLabel">10 min</div>
                  </div>
                  <input type="range" min="2" max="60" step="1" value="10" id="insecureWindowSlider" class="insecure-window-slider">
                  <p class="muted insecure-window-foot">Each `/auth` extends by this duration (2–60 minutes).</p>
                </div>
              </div>
              <div class="setting-block">
                <div class="setting-head">
                  <div>
                    <h3>Maintenance</h3>
                    <p class="muted" style="margin:2px 0 0;">Run the runner, seed auth.json, or check versions.</p>
                  </div>
                </div>
                <div class="setting-actions">
                  <button class="ghost" id="uploadAuthBtn">Seed auth.json</button>
                  <button class="ghost tiny-btn" id="runner-runner" title="Run auth-runner now">↻ Runner</button>
                  <button class="ghost" id="version-check">Check versions</button>
                </div>
              </div>
            </div>
          </section>
          </section>
          <section class="card panel" data-settings-panel="agents" hidden>
            <div class="panel-head">
              <div>
                <p class="eyebrow">Agents</p>
                <h2>Canonical AGENTS.md</h2>
                <p class="muted">Synced to every host via cdx.</p>
              </div>
              <div class="panel-actions">
                <button class="ghost tiny-btn" id="agentsEditToggle" title="Click to edit inline">Edit</button>
                <button class="primary tiny-btn" id="agentsSaveInline" hidden>Save</button>
              </div>
            </div>
            <div id="agentsStatus" class="muted" style="margin-bottom:8px;"></div>
            <div id="agentsMeta" class="muted" style="margin-bottom:8px;"></div>
            <pre id="agentsPreview" class="code-block" style="max-height:65vh; overflow:auto; cursor:text;"></pre>
            <textarea id="agentsEditorInline" rows="18" spellcheck="false" hidden style="width:100%; max-height:65vh; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;"></textarea>
          </section>
          <section class="card panel" data-settings-panel="prompts" hidden>
            <div class="panel-head">
              <div>
                <p class="eyebrow">Slash commands</p>
                <h2>Server-stored prompts</h2>
                <p class="muted">Edit the prompts baked into hosts.</p>
              </div>
              <div class="panel-actions">
                <button class="ghost tiny-btn" id="newCommandBtn">New</button>
              </div>
            </div>
            <div class="panel-body">
              <div class="table-wrapper">
                <table id="prompts">
                  <thead>
                    <tr>
                      <th>File</th>
                      <th>Description</th>
                      <th>Argument</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div class="muted" id="promptStatus" style="margin-top:8px;"></div>
          </section>
	          <section class="card panel" data-settings-panel="memories" hidden>
	            <div class="panel-head">
	              <div>
	                <h2>Memories</h2>
	                <p class="muted" style="margin:4px 0 0;">Browse MCP memories stored by hosts.</p>
	              </div>
	            </div>
	            <div class="memory-controls" id="memoriesFilters">
	              <div class="field">
	                <label for="memoriesQuery" style="font-weight:600;">Search</label>
	                <input id="memoriesQuery" type="text" placeholder="Text search (optional)">
	              </div>
              <div class="field narrow-field">
                <label for="memoriesHostFilter" style="font-weight:600;">Host</label>
                <select id="memoriesHostFilter">
                  <option value="">All hosts</option>
                </select>
              </div>
              <div class="field">
                <label for="memoriesTags" style="font-weight:600;">Tags</label>
                <input id="memoriesTags" type="text" placeholder="tag1, tag2 (optional)">
              </div>
              <div class="field narrow-field">
                <label for="memoriesLimit" style="font-weight:600;">Limit</label>
                <input id="memoriesLimit" type="number" min="1" max="200" value="50">
              </div>
            </div>
            <div class="table-wrap" id="memoriesTableWrap" hidden>
              <table id="memories">
                <thead>
                  <tr>
                    <th>Content</th>
                    <th>Tags</th>
                    <th>Updated</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
	            </div>
	            <div id="memoriesEmptyState" class="empty-state-box" hidden>
	              <div class="empty-state-title">No memories yet</div>
	              <div class="muted" style="margin-top:6px;">
	                This fleet hasn’t stored any MCP memories. Once a host writes memory via MCP, entries will show up here.
	              </div>
	            </div>
	          </section>
          <section class="card panel" data-settings-panel="config" hidden>
            <div class="panel-head">
              <div>
                <p class="eyebrow">Config Builder</p>
                <h2>config.toml generator</h2>
                <p class="muted">Generate, preview, and deploy the fleet-wide config in one place.</p>
              </div>
              <div class="panel-actions">
                <button id="renderConfig" class="ghost tiny-btn">Preview</button>
                <button id="copyPreview" class="ghost tiny-btn">Copy</button>
                <button id="saveConfig" class="primary">Save &amp; Deploy</button>
              </div>
            </div>
            <div class="panel-body">
              <div class="inline-group" style="margin-bottom:12px;">
                <div class="pill-quiet">Status: <span id="configStatus">Loading…</span></div>
                <div class="pill-quiet">SHA: <span id="configSha">—</span></div>
                <div class="pill-quiet">Updated: <span id="configUpdated">—</span></div>
              </div>
              <div class="config-grid">
                <div class="config-card">
                  <h3>Model &amp; Behavior</h3>
                  <p>Pick the model and how it reasons, responds, and sizes outputs.</p>
                  <div class="field">
	                    <label for="modelInput">Model</label>
	                    <select id="modelInput">
	                      <option value="gpt-5.2">gpt-5.2</option>
	                      <option value="gpt-5.1-codex-max">gpt-5.1-codex-max</option>
	                      <option value="gpt-5.1-codex">gpt-5.1-codex</option>
	                      <option value="gpt-5.1-codex-mini">gpt-5.1-codex-mini</option>
	                      <option value="gpt-5.1">gpt-5.1</option>
	                    </select>
	                  </div>
                  <div class="inline-group">
                    <div class="field">
                      <label for="reasoningEffortInput">Model Reasoning Effort</label>
                      <select id="reasoningEffortInput">
                        <option value="">—</option>
                        <option value="low">low</option>
                        <option value="medium">medium</option>
                        <option value="high">high</option>
                        <option value="xhigh">xhigh</option>
                      </select>
                    </div>
                    <div class="field">
                      <label for="reasoningSummaryInput">Reasoning Summary</label>
                      <select id="reasoningSummaryInput">
                        <option value="">—</option>
                        <option value="auto">auto</option>
                        <option value="concise">concise</option>
                        <option value="detailed">detailed</option>
                      </select>
                    </div>
                    <div class="field">
                      <label for="verbosityInput">Verbosity</label>
                      <select id="verbosityInput">
                        <option value="">—</option>
                        <option value="low">low</option>
                        <option value="medium">medium</option>
                        <option value="high">high</option>
                      </select>
                    </div>
                  </div>
                  <div class="inline-group">
                    <div class="field">
                      <label for="contextWindowInput">Context Window</label>
                      <input id="contextWindowInput" type="number" min="0" placeholder="e.g. 128000">
                    </div>
                    <div class="field">
                      <label for="maxTokensInput">Max Output Tokens</label>
                      <input id="maxTokensInput" type="number" min="0" placeholder="e.g. 4096">
                    </div>
                    <div class="field">
                      <label style="align-items:center; gap:8px;">
                        <span>Force reasoning summaries</span>
                        <input id="supportsSummariesInput" type="checkbox" style="width:auto; accent-color: var(--accent);">
                      </label>
                    </div>
                  </div>
                  <div class="field">
                    <label for="notifyInput">Notify command</label>
                    <textarea id="notifyInput" placeholder="One argument per line, e.g.&#10;python3&#10;/path/to/notify.py"></textarea>
                    <div class="muted-note">Maps to <code>notify = ["arg1","arg2",...]</code>.</div>
                  </div>
                </div>

                <div class="config-card">
                  <h3>Security &amp; Features</h3>
                  <p>Guardrails plus the extras you want surfaced to users.</p>
                  <div class="field">
                    <label for="approvalPolicyInput">Approval policy</label>
                    <select id="approvalPolicyInput">
                      <option value="on-request">on-request</option>
                      <option value="untrusted">untrusted</option>
                      <option value="on-failure">on-failure</option>
                      <option value="never">never</option>
                    </select>
                  </div>
                  <div class="feature-list">
                    <label class="feature-toggle">
                      <input type="checkbox" id="featureStreamShell" style="width:auto; accent-color: var(--accent);">
                      <div>
                        <div class="feature-title">Stream shell output</div>
                        <div class="feature-desc">Show long-running command output live instead of in one big dump.</div>
                      </div>
                    </label>
                    <label class="feature-toggle">
                      <input type="checkbox" id="featureWebSearch" style="width:auto; accent-color: var(--accent);">
                      <div>
                        <div class="feature-title">Allow web search</div>
                        <div class="feature-desc">Let Codex reach out for fresh context when it needs it.</div>
                      </div>
                    </label>
                    <label class="feature-toggle">
                      <input type="checkbox" id="featureViewImage" style="width:auto; accent-color: var(--accent);" checked>
                      <div>
                        <div class="feature-title">Allow image viewer</div>
                        <div class="feature-desc">Preview images directly in the conversation instead of downloading them.</div>
                      </div>
                    </label>
                  </div>
                  <div class="field">
                    <label for="extraFeaturesInput">Advanced flags (optional)</label>
                    <textarea id="extraFeaturesInput" placeholder='feature_name=true or JSON object e.g. {"feature":true}'></textarea>
                    <div class="muted-note">One per line works, or drop in a JSON object.</div>
                  </div>
                </div>

                <div class="config-card">
                  <h3>Sandbox &amp; Environment</h3>
                  <p>Control workspace access, env visibility, and permissions.</p>
                  <div class="field">
                    <label for="sandboxModeInput">Sandbox mode</label>
                    <select id="sandboxModeInput">
                      <option value="workspace-write">workspace-write</option>
                      <option value="read-only">read-only</option>
                      <option value="danger-full-access">danger-full-access</option>
                    </select>
                  </div>
                  <div class="feature-list">
                    <label class="feature-toggle">
                      <input type="checkbox" id="sandboxNetwork" style="width:auto; accent-color: var(--accent);">
                      <div>
                        <div class="feature-title">Allow network access</div>
                        <div class="feature-desc">Let workspace commands reach the internet.</div>
                      </div>
                    </label>
                    <label class="feature-toggle">
                      <input type="checkbox" id="sandboxTmpdir" style="width:auto; accent-color: var(--accent);">
                      <div>
                        <div class="feature-title">Exclude $TMPDIR</div>
                        <div class="feature-desc">Skip the host's $TMPDIR to keep temp files private.</div>
                      </div>
                    </label>
                    <label class="feature-toggle">
                      <input type="checkbox" id="sandboxSlashTmp" style="width:auto; accent-color: var(--accent);">
                      <div>
                        <div class="feature-title">Exclude /tmp</div>
                        <div class="feature-desc">Hide /tmp from the sandbox.</div>
                      </div>
                    </label>
                  </div>
                  <div class="field">
                    <label for="writableRootsInput">Writable roots</label>
                    <textarea id="writableRootsInput" placeholder="/path/one&#10;/path/two"></textarea>
                  </div>
                  <div class="field">
                    <label for="envInheritInput">Shell env inherit</label>
                    <input id="envInheritInput" type="text" placeholder="safe | none | full">
                  </div>
                  <div class="field">
                    <label for="envIncludeInput">Include only</label>
                    <textarea id="envIncludeInput" placeholder="PATH&#10;HOME"></textarea>
                  </div>
                  <div class="field">
                    <label for="envExcludeInput">Exclude patterns</label>
                    <textarea id="envExcludeInput" placeholder="AWS_*&#10;AZURE_*"></textarea>
                  </div>
                  <div class="field">
                    <label for="envSetInput">Set env (key=value per line)</label>
                    <textarea id="envSetInput" placeholder="PATH=/usr/bin&#10;MY_FLAG=1"></textarea>
                  </div>
                  <label class="feature-toggle" style="margin-top:6px;">
                    <input type="checkbox" id="ignoreDefaultExcludesInput" style="width:auto; accent-color: var(--accent);">
                    <div>
                      <div class="feature-title">Ignore default env excludes</div>
                      <div class="feature-desc">Skip the built-in env blacklist (AWS_*, etc.).</div>
                    </div>
                  </label>
                </div>

                <div class="config-card">
                  <h3>Profiles</h3>
                  <p>Per-profile overrides for CLI <code>--profile</code>.</p>
                  <div class="row-actions">
                    <button type="button" id="addProfileBtn" class="ghost tiny-btn">+ Add profile</button>
                    <span class="muted-note">Model / provider / approval / sandbox / reasoning.</span>
                  </div>
                  <div id="profileRows" class="list-rows"></div>
                </div>

                <div class="config-card">
                  <h3>MCP &amp; Telemetry</h3>
                  <p>Wire Codex-Coordinator memory MCP or other servers, plus OTEL.</p>
                  <div class="row-actions" style="align-items:center;">
                    <label class="toggle state-toggle" style="display:inline-flex; align-items:center; gap:10px;">
                      <input type="checkbox" id="orchestratorMcpToggle">
                      <span class="track"><span class="thumb"></span></span>
                      <span class="toggle-text">codex-orchestrator MCP</span>
                    </label>
                  </div>
                  <div id="orchestratorMcpSummaryWrap" class="field" style="margin-top:4px;" hidden>
                    <span class="muted-note" style="font-weight:600;">Injected per host</span>
                    <div id="orchestratorMcpSummary" class="mono-block" style="margin-top:6px; font-size:12px; line-height:1.4;"></div>
                    <span class="muted-note">Auth token is the host's API key; rendered per-host on fetch.</span>
                  </div>
                  <div class="row-actions">
                    <button type="button" id="addMcpBtn" class="ghost tiny-btn">+ Add MCP server</button>
                    <span class="muted-note">Command + args; include your API base if needed.</span>
                  </div>
                  <details id="mcpAccordion" class="mcp-accordion" hidden>
                    <summary>
                      <span>Configured MCP servers</span>
                      <span class="pill-quiet" id="mcpCount">0</span>
                    </summary>
                    <div id="mcpRows" class="list-rows"></div>
                  </details>
                  <div class="inline-group">
                    <div class="field">
                      <label for="otelExporterInput">Exporter</label>
                      <select id="otelExporterInput">
                        <option value="none">none</option>
                        <option value="otlp-http">otlp-http</option>
                        <option value="otlp-grpc">otlp-grpc</option>
                      </select>
                    </div>
                    <div class="field">
                      <label for="otelEndpointInput">Endpoint</label>
                      <input id="otelEndpointInput" type="text" placeholder="https://otel.example.com">
                    </div>
                    <div class="field">
                      <label for="otelProtocolInput">Protocol</label>
                      <input id="otelProtocolInput" type="text" placeholder="binary | json">
                    </div>
                  </div>
                  <div class="field">
                    <label for="otelHeadersInput">Headers (key=value)</label>
                    <textarea id="otelHeadersInput" placeholder='x-otlp-api-key=${OTLP_TOKEN}'></textarea>
                  </div>
                  <label class="field" style="flex-direction:row; align-items:center; gap:8px;">
                    <input type="checkbox" id="otelLogPromptsInput" style="width:auto; accent-color: var(--accent);">
                    <span>log_user_prompt</span>
                  </label>
                </div>

                <div class="config-card">
                  <h3>Custom TOML</h3>
                  <p>Any additional blocks or overrides appended verbatim.</p>
                  <div class="field">
                    <textarea id="customTomlInput" placeholder="# Extra settings&#10;[features]&#10;custom_feature = true"></textarea>
                  </div>
                </div>
              </div>

              <div class="config-card" style="margin-top:14px;">
                <div class="preview-actions">
                  <div>
                    <h3 style="margin:0;">Rendered config.toml</h3>
                    <p class="tagline">Preview is built via the server renderer so hashes match deployed files.</p>
                  </div>
                  <div class="row-actions">
                    <button type="button" id="copyPreview" class="ghost tiny-btn">Copy</button>
                    <span class="muted-note" id="previewMeta">—</span>
                  </div>
                </div>
                <div id="configPreview" class="mono-block" aria-label="Rendered config.toml">Loading…</div>
              </div>
            </div>
          </section>
        </section>
      </main>
    </div>
  </div>
  <script>
    // Basic hash router to set initial view for legacy JS
    (function() {
      function applyFromHash() {
        const hash = (window.location.hash || '#dashboard').replace(/^#/, '');
        const [panel, sub] = hash.split('/');
        document.body.dataset.viewMode = panel || 'dashboard';
        if (panel === 'hosts') {
          document.body.dataset.hostTab = sub || '';
        }
        if (panel === 'logs') {
          document.body.dataset.logTab = sub || 'client';
        }
        if (panel === 'settings') {
          document.body.dataset.settingsTab = sub || 'general';
        }
      }
      applyFromHash();
      window.addEventListener('hashchange', applyFromHash);
    })();
  </script>
	  <script src="/admin/assets/nav.js?v=2025-12-12-01"></script>
	  <script src="/admin/assets/dashboard.js?v=2025-12-12-01"></script>
	  <script src="/admin/assets/logs.js?v=2025-12-12-01"></script>
	  <script src="/admin/assets/config.js?v=2025-12-12-01"></script>
</body>
</html>
