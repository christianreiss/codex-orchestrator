<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Codex-Coordinator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css?v=2025-12-08-09">
  <link rel="stylesheet" href="dashboard-mobile.css?v=2025-12-08-02">
</head>
<body data-view="desktop" data-view-mode="dashboard">
  <header class="main-nav">
    <div class="nav-brand">
      <img class="brand-logo" src="openai-logo.svg" alt="OpenAI logo">
      <div>
        <div class="brand-title">Codex Coordinator</div>
      </div>
    </div>
    <nav class="nav-groups">
      <a class="nav-item" href="/admin/?view=dashboard" data-nav="dashboard">Dashboard</a>
      <div class="nav-item has-children" data-nav="hosts">
        <button type="button" class="nav-trigger" aria-expanded="false"><span>Hosts</span><span class="caret">▾</span></button>
        <div class="nav-dropdown">
          <a href="/admin/hosts.html?host=secure" data-nav-host="secure">Secure hosts</a>
          <a href="/admin/hosts.html?host=insecure" data-nav-host="insecure">Insecure hosts</a>
          <a href="/admin/hosts.html?host=unprovisioned" data-nav-host="unprovisioned">Unprovisioned</a>
          <a href="/admin/hosts.html?newHost=1" data-nav-newhost>+ New host</a>
        </div>
      </div>
      <div class="nav-item has-children" data-nav="logs">
        <button type="button" class="nav-trigger" aria-expanded="false"><span>Logs</span><span class="caret">▾</span></button>
        <div class="nav-dropdown">
          <a href="/admin/logs.html">Client logs</a>
          <a href="/admin/mcp-logs.html">MCP access</a>
        </div>
      </div>
      <div class="nav-item has-children" data-nav="settings">
        <button type="button" class="nav-trigger" aria-expanded="false"><span>Settings</span><span class="caret">▾</span></button>
        <div class="nav-dropdown">
          <a href="/admin/settings.html" data-nav-jump="settings">cdx settings</a>
          <a href="/admin/agents.html" data-nav-jump="agents">Agents</a>
          <a href="/admin/prompts.html" data-nav-jump="prompts">Slash commands</a>
          <a href="/admin/memories.html" data-nav-jump="memories">Memories</a>
          <a href="/admin/config.html">config.toml</a>
        </div>
      </div>
    </nav>
    <div class="nav-actions">
      <button class="nav-btn primary" id="navNewHost">New host</button>
    </div>
  </header>
  <div class="app">
    <div class="content">
      <section class="page-hero">
        <div>
          <p class="eyebrow">Dashboard</p>
          <h1>Fleet overview</h1>
          <p class="muted">Lightweight, square, and consistent across every admin page.</p>
        </div>
      </section>
      <nav class="menu-line" aria-label="Dashboard menu">
        <a class="menu-link" href="/admin/?view=dashboard">Overview</a>
        <a class="menu-link" href="/admin/?view=hosts">Hosts</a>
        <a class="menu-link" href="/admin/logs.html">Logs</a>
        <a class="menu-link" href="/admin/?view=agents">Agents</a>
        <a class="menu-link" href="/admin/?view=prompts">Slash commands</a>
        <a class="menu-link" href="/admin/?view=memories">Memories</a>
        <a class="menu-link" href="/admin/?view=settings">Settings</a>
      </nav>
      <main class="main">
        <div class="modal-backdrop" id="seedModal">
          <div class="modal seed-modal">
            <h3>Initial seeding required</h3>
            <p class="muted" id="seedModalCopy">This installation has no hosts or canonical auth.json yet. Seed auth.json before issuing installers.</p>
            <div class="seed-status">
              <div class="seed-chip warn" id="seedHostsStatus"><span class="dot"></span>No hosts registered</div>
              <div class="seed-chip warn" id="seedAuthStatus"><span class="dot"></span>Canonical auth.json missing</div>
            </div>
            <div class="actions">
              <button class="ghost" id="seedDismissBtn">Close</button>
              <button id="seedUploadBtn">Seed auth.json</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="newHostModal">
          <div class="modal">
            <h3>New Host</h3>
            <p>Issue a one-time installer link for this FQDN. The API key is baked in and bound to this host on first contact.</p>
            <div class="field">
              <label for="new-host-name" style="font-weight:600;">Host FQDN</label>
              <input id="new-host-name" type="text" placeholder="e.g. node-01.example.com">
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="secureHostToggle">
                <input type="checkbox" id="secureHostToggle" checked>
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">Secure host (keep auth.json after runs)</span>
              </label>
              <p class="muted" style="margin:6px 0 0;">Off = treat as insecure; cdx removes auth.json after each run.</p>
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="insecureToggle">
                <input type="checkbox" id="insecureToggle">
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">Allow insecure curl (-k)</span>
              </label>
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="ipv4Toggle">
                <input type="checkbox" id="ipv4Toggle">
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">Force IPv4 (curl -4)</span>
              </label>
            </div>
            <div class="field">
              <label class="toggle state-toggle" for="vipToggle">
                <input type="checkbox" id="vipToggle">
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-text">VIP host (ignore quota kill switch)</span>
              </label>
            </div>
            <div class="field" id="commandField" style="display:none;">
              <label style="font-weight:600;">Run on the target host</label>
              <div class="command-box">
                <span class="cmd-text" id="bootstrapCmd"></span>
                <button class="copy-btn" id="copyCmd">Copy</button>
              </div>
              <p class="muted" id="installerMeta" style="margin-top:8px; display:none;"></p>
              <p class="muted" style="margin-top:8px;">Single command downloads the baked installer and configures the host.</p>
              </div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
              <button class="ghost" id="cancelNewHost">Cancel</button>
              <button id="createHost">Generate</button>
            </div>
          </div>
        </div>

        <div class="modal-backdrop" id="uploadModal">
          <div class="modal">
            <h3>Seed auth.json</h3>
            <p>Paste or choose an auth.json; it will be validated via the runner and stored as canonical.</p>
            <div class="field">
              <label for="uploadHostSelect" style="font-weight:600;">Store scope</label>
              <select id="uploadHostSelect"></select>
            </div>
            <div class="field">
              <label for="uploadAuthText" style="font-weight:600;">auth.json</label>
              <textarea id="uploadAuthText" rows="8" placeholder='{"last_refresh":"...","auths":{...}}'></textarea>
            </div>
            <div class="field">
              <label style="font-weight:600;">or choose file</label>
              <input type="file" id="uploadAuthFile" accept=".json,application/json">
            </div>
            <div id="uploadStatus" class="muted" style="min-height:18px; font-size:13px;"></div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
              <button class="ghost" id="uploadAuthCancel">Cancel</button>
              <button id="uploadAuthSubmit">Upload</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="deleteHostModal">
          <div class="modal">
            <h3>Remove host</h3>
            <p id="delete-host-text" class="muted"></p>
            <div class="actions">
              <button class="ghost" id="cancelDeleteHost">Cancel</button>
              <button class="danger" id="confirmDeleteHost">Remove</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="hostDetailModal">
          <div class="modal host-detail-modal">
            <div class="host-detail-head">
              <div>
                <p class="muted overline">Authorized Host</p>
                <h3 id="hostDetailTitle">Loading…</h3>
                <div class="chip-row" id="hostDetailPills"></div>
              </div>
              <div class="host-detail-head-actions">
                <button class="ghost tiny-btn" id="closeHostDetail">Close</button>
              </div>
            </div>
            <div class="host-detail-summary" id="hostDetailSummary"></div>
            <div class="kv-grid" id="hostDetailGrid"></div>
            <div class="host-detail-actions" id="hostDetailActions"></div>
          </div>
        </div>
        <div class="modal-backdrop" id="runnerModal">
          <div class="modal">
            <h3>Auth runner</h3>
            <p class="muted">Manual runner invocation with live output and the final decision.</p>
            <div class="runner-meta" id="runnerMeta"></div>
            <div class="runner-log" id="runnerLog" aria-live="polite"></div>
            <div class="actions">
              <button class="ghost" id="runnerClose">Close</button>
            </div>
          </div>
        </div>
        <div class="modal-backdrop" id="upgradeModal">
          <div class="modal">
            <h3>Codex Upgrade Notes</h3>
            <p class="muted" id="upgradeVersionLabel"></p>
            <div class="upgrade-notes" id="upgradeNotes">Loading…</div>
            <div class="actions">
              <button class="ghost" id="upgradeGithubLink" type="button">Open on GitHub</button>
              <button class="ghost" id="upgradeClose">Close</button>
            </div>
          </div>
        </div>

        <div class="modal-backdrop" id="usageHistoryModal">
          <div class="modal usage-history-modal">
            <div class="modal-head">
              <div>
                <h3>ChatGPT Quota Trend</h3>
                <p class="muted" id="usageHistorySubtitle">Loading…</p>
              </div>
              <button class="ghost tiny-btn" id="usageHistoryClose">Close</button>
            </div>
            <div class="usage-history-chart" id="usageHistoryChart">Loading…</div>
            <div class="muted" id="usageHistoryMeta" style="margin-top:8px;"></div>
          </div>
        </div>

        <div class="modal-backdrop" id="costHistoryModal">
          <div class="modal usage-history-modal">
            <div class="modal-head">
              <div>
                <h3>Cost Trend</h3>
                <p class="muted" id="costHistorySubtitle">Loading…</p>
              </div>
              <button class="ghost tiny-btn" id="costHistoryClose">Close</button>
            </div>
            <div class="usage-history-chart cost-history-chart" id="costHistoryChart">Loading…</div>
            <div class="muted" id="costHistoryMeta" style="margin-top:8px;"></div>
          </div>
        </div>

        <section class="grid metrics" id="stats"></section>

        <section class="card usage-card" id="chatgpt-usage-card">
          <div class="muted">Loading ChatGPT usage…</div>
        </section>

        <section class="card panel" id="hosts-panel">
          <div class="panel-head">
            <div>
              <h2>Authorized Hosts</h2>
            </div>
            <div class="panel-actions">
              <input type="search" id="host-filter" placeholder="Search host, IP, or version">
            </div>
          </div>
          <div class="table-wrap">
            <table id="hosts">
              <thead>
                <tr>
                  <th data-sort-key="host"><span class="sort-link" role="button" tabindex="0" data-sort="host"><span>Host</span><span class="sort-indicator">↕</span></span></th>
                  <th data-sort-key="last_seen"><span class="sort-link" role="button" tabindex="0" data-sort="last_seen"><span>Last Seen</span><span class="sort-indicator">↕</span></span></th>
                  <th data-sort-key="client"><span class="sort-link" role="button" tabindex="0" data-sort="client"><span>Client</span><span class="sort-indicator">↕</span></span></th>
                  <th data-sort-key="wrapper"><span class="sort-link" role="button" tabindex="0" data-sort="wrapper"><span>Wrapper</span><span class="sort-indicator">↕</span></span></th>
                  <th data-sort-key="ip"><span class="sort-link" role="button" tabindex="0" data-sort="ip"><span>IP / Mode</span><span class="sort-indicator">↕</span></span></th>
                  <th class="insecure-col">Insecure API</th>
                </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
        </section>

        <section class="card panel" id="memories-panel">
          <div class="panel-head">
            <div>
              <h2>Memories</h2>
              <p class="muted" style="margin:4px 0 0;">Browse MCP memories stored by hosts.</p>
            </div>
            <div class="panel-actions" style="gap:10px;">
              <a class="ghost tiny-btn" href="/admin/mcp-logs.html" style="text-decoration:none;line-height:28px;">Access Logs</a>
              <button class="ghost tiny-btn" id="memoriesToggle">Show</button>
              <button class="ghost tiny-btn" id="memoriesRefreshBtn">Refresh</button>
            </div>
          </div>
          <div class="memory-controls" id="memoriesFilters" hidden>
            <div class="field">
              <label for="memoriesQuery" style="font-weight:600;">Search</label>
              <input id="memoriesQuery" type="text" placeholder="Text search (optional)">
            </div>
            <div class="field narrow-field">
              <label for="memoriesHostFilter" style="font-weight:600;">Host</label>
              <select id="memoriesHostFilter">
                <option value="">All hosts</option>
              </select>
            </div>
            <div class="field">
              <label for="memoriesTags" style="font-weight:600;">Tags</label>
              <input id="memoriesTags" type="text" placeholder="tag1, tag2 (optional)">
            </div>
            <div class="field narrow-field">
              <label for="memoriesLimit" style="font-weight:600;">Limit</label>
              <input id="memoriesLimit" type="number" min="1" max="200" value="50">
            </div>
          </div>
          <div class="table-wrap" id="memoriesTableWrap" hidden>
            <table id="memories">
              <thead>
                <tr>
                  <th>Content</th>
                  <th>Tags</th>
                  <th>Updated</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <section class="card panel settings-panel" id="settings-panel">
          <div class="panel-head">
            <div>
              <h2>Operations & Settings</h2>
              <p class="muted" style="margin:4px 0 0;">Emergency toggles and runner utilities.</p>
            </div>
            <div class="panel-actions">
              <button class="ghost tiny-btn" id="settingsToggle">Show</button>
            </div>
          </div>
          <div class="settings-grid">
            <div class="setting-block">
              <div class="setting-head">
                <div>
                  <h3>Quota Policy</h3>
                  <p class="muted quota-desc" style="margin:2px 0 0;">ChatGPT quota hit: deny Codex launch.</p>
                </div>
                <label class="toggle" for="quotaHardFailToggle">
                  <input type="checkbox" id="quotaHardFailToggle">
                  <span class="track"><span class="thumb"></span></span>
                  <span class="toggle-text" id="quotaModeLabel">Deny launches</span>
                </label>
              </div>
              <div class="quota-limit-control">
                <div class="quota-limit-head">
                  <p class="muted" style="margin:0;">Warn/kill at</p>
                  <div class="quota-limit-value" id="quotaLimitLabel">100%</div>
                </div>
                <input type="range" min="50" max="100" step="1" value="100" id="quotaLimitSlider" class="quota-limit-slider">
                <p class="muted quota-limit-foot">Used percent that triggers warnings (or failures when deny mode is on).</p>
              </div>
              <div class="quota-partition-control">
                <div class="quota-limit-head">
                  <p class="muted" style="margin:0;">Week partition</p>
                  <div class="quota-limit-value" id="quotaPartitionLabel">Off</div>
                </div>
                <select id="quotaPartitionSelect" class="quota-partition-select">
                  <option value="0">Off (default)</option>
                  <option value="7">7 days (100/7 daily)</option>
                  <option value="5">5 days: Mon-Fri (100/5 daily)</option>
                </select>
                <p class="muted quota-limit-foot">Adds a daily allowance bar in cdx; honours deny/warn mode.</p>
              </div>
            </div>
            <div class="setting-block">
              <div class="setting-head">
                <div>
                  <h3>API Kill Switch</h3>
                  <p class="muted" style="margin:2px 0 0;">Emergency stop for Codex agents.</p>
                </div>
                <label class="toggle" for="apiToggle">
                  <input type="checkbox" id="apiToggle">
                  <span class="track"><span class="thumb"></span></span>
                  <span class="toggle-text" id="apiToggleLabel">Enabled</span>
                </label>
              </div>
            </div>
            <div class="setting-block">
              <div class="setting-head">
                <div>
                  <h3>cdx Silent Mode</h3>
                  <p class="muted" style="margin:2px 0 0;">Hide wrapper boot logs; only errors print.</p>
                </div>
                <label class="toggle" for="cdxSilentToggle">
                  <input type="checkbox" id="cdxSilentToggle">
                  <span class="track"><span class="thumb"></span></span>
                  <span class="toggle-text" id="cdxSilentLabel">Verbose</span>
                </label>
              </div>
            </div>
            <div class="setting-block">
              <div class="setting-head">
                <div>
                  <h3>Insecure Host Window</h3>
                  <p class="muted" style="margin:2px 0 0;">Duration granted when enabling insecure hosts.</p>
                </div>
              </div>
              <div class="insecure-window-control">
                <div class="insecure-window-head">
                  <div>
                    <p class="muted insecure-window-copy">Applies to the next enable and persists locally.</p>
                  </div>
                  <div class="insecure-window-value" id="insecureWindowLabel">10 min</div>
                </div>
                <input type="range" min="2" max="60" step="1" value="10" id="insecureWindowSlider" class="insecure-window-slider">
                <div class="insecure-window-foot muted">Each `/auth` extends by this duration (2–60 minutes).</div>
              </div>
            </div>
            <div class="setting-block">
              <div class="setting-head">
                <div>
                  <h3>Maintenance</h3>
                  <p class="muted" style="margin:2px 0 0;">Run the runner, seed auth.json, or check versions.</p>
                </div>
              </div>
              <div class="setting-actions">
                <button class="ghost" id="uploadAuthBtn">Seed auth.json</button>
                <button class="ghost tiny-btn" id="runner-runner" title="Run auth-runner now">↻ Runner</button>
                <button class="ghost" id="version-check">Check versions</button>
              </div>
            </div>

            <div class="setting-block">
              <div class="setting-head">
                <div>
                  <h3>config.toml Generator</h3>
                  <p class="muted" style="margin:2px 0 0;">Render and download the host config with managed MCP baked in.</p>
                </div>
              </div>
              <div class="setting-actions">
                <button class="ghost" type="button" onclick="window.location.href='/admin/config.html'">Open generator</button>
              </div>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>
  <script src="nav.js?v=2025-12-08-05"></script>
  <script src="dashboard.js?v=2025-12-08-05"></script>
</body>
</html>
