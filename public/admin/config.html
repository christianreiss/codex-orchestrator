<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Codex-Coordinator · config.toml Builder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css?v=2025-12-08-30">
  <link rel="stylesheet" href="dashboard-mobile.css?v=2025-12-08-02">
  <style>
    .config-grid { display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); margin-top: 12px; }
    .config-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; box-shadow: var(--shadow); }
    .config-card h3 { margin: 0 0 8px; font-size: 16px; display: flex; align-items: center; gap: 8px; }
    .config-card p { margin: 0 0 10px; color: var(--muted); font-size: 13px; }
    .field { margin-bottom: 10px; display: flex; flex-direction: column; gap: 4px; }
    .field label { font-weight: 600; font-size: 13px; color: var(--muted); display: flex; justify-content: space-between; align-items: center; }
    .field input,
    .field select,
    .field textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; font-size: 14px; color: var(--text); font-family: 'Inter', system-ui, sans-serif; }
    .field textarea { min-height: 80px; resize: vertical; }
    .muted-note { color: var(--muted); font-size: 12px; }
    .inline-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; }
    .pill-quiet { background: var(--frost); color: var(--muted); border-radius: 999px; padding: 6px 10px; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; border: 1px solid var(--border); }
    .row-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-top: 6px; }
    .list-rows { display: flex; flex-direction: column; gap: 10px; }
    .row-card { border: 1px dashed var(--border); border-radius: 12px; padding: 10px; background: #fff; }
    .mono-block { background: #0f172a; color: #e5e7eb; border-radius: 12px; padding: 12px; font-family: 'JetBrains Mono', 'Courier New', monospace; font-size: 13px; white-space: pre; overflow-x: auto; }
    .preview-actions { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .tagline { color: var(--muted); font-size: 14px; margin: 0; }
    .feature-list { display: flex; flex-direction: column; gap: 8px; margin-top: 2px; }
    .feature-toggle { border: 1px solid var(--border); background: #fff; border-radius: 10px; padding: 10px; display: flex; gap: 10px; align-items: flex-start; box-shadow: var(--shadow); }
    .feature-toggle input { margin-top: 3px; }
    .feature-title { font-weight: 600; color: var(--text); font-size: 13px; }
    .feature-desc { color: var(--muted); font-size: 12px; }
    .mcp-accordion { margin-top: 8px; border: 1px solid var(--border); border-radius: 12px; background: #fff; box-shadow: var(--shadow-soft, 0 1px 2px rgba(0,0,0,0.04)); }
    .mcp-accordion[hidden] { display: none; }
    .mcp-accordion summary { cursor: pointer; list-style: none; padding: 10px 12px; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .mcp-accordion summary::-webkit-details-marker { display: none; }
    .mcp-accordion .list-rows { padding: 0 12px 12px; margin-bottom: 0; }
  </style>
</head>
<body data-view="desktop">
  <header class="main-nav">
    <div class="nav-brand">
      <img class="brand-logo" src="openai-logo.svg" alt="OpenAI logo">
      <div>
        <div class="brand-title">Codex Coordinator</div>
      </div>
    </div>
    <nav class="nav-groups">
      <a class="nav-item" href="/admin/?view=dashboard" data-nav="dashboard">Dashboard</a>
      <a class="nav-item" href="/admin/hosts.html" data-nav="hosts">Hosts</a>
      <a class="nav-item" href="/admin/logs.html" data-nav="logs">Logs</a>
      <a class="nav-item" href="/admin/settings.html" data-nav="settings">Settings</a>
    </nav>
    <div class="nav-actions">
      <button class="nav-btn primary" onclick="window.location.href='/admin/?newHost=1#hosts-panel'">New host</button>
      <button class="nav-btn ghost" onclick="window.location.href='/admin/#settings-panel'">Settings</button>
    </div>
  </header>
  <div class="app">
    <div class="content">
      <section class="page-hero">
        <div>
          <p class="eyebrow">Settings</p>
          <h1>config.toml Builder</h1>
          <p class="muted">Generate, preview, and deploy the fleet-wide config in one place.</p>
        </div>
        <div class="hero-actions">
          <button type="button" class="ghost tiny-btn" onclick="document.getElementById('renderConfig')?.click()">Preview</button>
          <button type="button" class="primary" onclick="document.getElementById('saveConfig')?.click()">Save &amp; Deploy</button>
        </div>
      </section>
      <main class="main">
        <section class="card panel">
          <div class="panel-head">
            <div>
              <h2>Generate and deploy config.toml</h2>
              <p class="muted" style="margin:4px 0 0;">Built server-side, synced by cdx to <span class="mono">~/.codex/config.toml</span>.</p>
            </div>
            <div class="panel-actions">
              <button id="renderConfig" class="ghost tiny-btn">Preview</button>
              <button id="saveConfig" class="primary">Save &amp; Deploy</button>
            </div>
          </div>
          <div class="panel-body">
            <div class="inline-group" style="margin-bottom:12px;">
              <div class="pill-quiet">Status: <span id="configStatus">Loading…</span></div>
              <div class="pill-quiet">SHA: <span id="configSha">—</span></div>
              <div class="pill-quiet">Updated: <span id="configUpdated">—</span></div>
            </div>
            <div class="config-grid">
              <div class="config-card">
                <h3>Model &amp; Behavior</h3>
                <p>Pick the model and how it reasons, responds, and sizes outputs.</p>
                <div class="field">
                  <label for="modelInput">Model</label>
                  <select id="modelInput">
                    <option value="gpt-5.1-codex">gpt-5.1-codex</option>
                    <option value="gpt-5.1-codex-max">gpt-5.1-codex-max</option>
                    <option value="gpt-5.1-codex-mini">gpt-5.1-codex-mini</option>
                    <option value="gpt-5.1">gpt-5.1</option>
                  </select>
                </div>
                <div class="inline-group">
                  <div class="field">
                    <label for="reasoningEffortInput">Model Reasoning Effort</label>
                    <select id="reasoningEffortInput">
                      <option value="">—</option>
                      <option value="low">low</option>
                      <option value="medium">medium</option>
                      <option value="high">high</option>
                      <option value="xhigh">xhigh</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="reasoningSummaryInput">Reasoning Summary</label>
                    <select id="reasoningSummaryInput">
                      <option value="">—</option>
                      <option value="auto">auto</option>
                      <option value="concise">concise</option>
                      <option value="detailed">detailed</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="verbosityInput">Verbosity</label>
                    <select id="verbosityInput">
                      <option value="">—</option>
                      <option value="low">low</option>
                      <option value="medium">medium</option>
                      <option value="high">high</option>
                    </select>
                  </div>
                </div>
                <div class="inline-group">
                  <div class="field">
                    <label for="contextWindowInput">Context Window</label>
                    <input id="contextWindowInput" type="number" min="0" placeholder="e.g. 128000">
                  </div>
                  <div class="field">
                    <label for="maxTokensInput">Max Output Tokens</label>
                    <input id="maxTokensInput" type="number" min="0" placeholder="e.g. 4096">
                  </div>
                  <div class="field">
                    <label style="align-items:center; gap:8px;">
                      <span>Force reasoning summaries</span>
                      <input id="supportsSummariesInput" type="checkbox" style="width:auto; accent-color: var(--accent);">
                    </label>
                  </div>
                </div>
                <div class="field">
                  <label for="notifyInput">Notify command</label>
                  <textarea id="notifyInput" placeholder="One argument per line, e.g.&#10;python3&#10;/path/to/notify.py"></textarea>
                  <div class="muted-note">Maps to <code>notify = ["arg1","arg2",...]</code>.</div>
                </div>
              </div>

              <div class="config-card">
                <h3>Security &amp; Features</h3>
                <p>Guardrails plus the extras you want surfaced to users.</p>
                <div class="field">
                  <label for="approvalPolicyInput">Approval policy</label>
                  <select id="approvalPolicyInput">
                    <option value="on-request">on-request</option>
                    <option value="untrusted">untrusted</option>
                    <option value="on-failure">on-failure</option>
                    <option value="never">never</option>
                  </select>
                </div>
                <div class="feature-list">
                  <label class="feature-toggle">
                    <input type="checkbox" id="featureStreamShell" style="width:auto; accent-color: var(--accent);">
                    <div>
                      <div class="feature-title">Stream shell output</div>
                      <div class="feature-desc">Show long-running command output live instead of in one big dump.</div>
                    </div>
                  </label>
                  <label class="feature-toggle">
                    <input type="checkbox" id="featureWebSearch" style="width:auto; accent-color: var(--accent);">
                    <div>
                      <div class="feature-title">Allow web search</div>
                      <div class="feature-desc">Let Codex reach out for fresh context when it needs it.</div>
                    </div>
                  </label>
                  <label class="feature-toggle">
                    <input type="checkbox" id="featureViewImage" style="width:auto; accent-color: var(--accent);" checked>
                    <div>
                      <div class="feature-title">Allow image viewer</div>
                      <div class="feature-desc">Preview images directly in the conversation instead of downloading them.</div>
                    </div>
                  </label>
                </div>
                <div class="field">
                  <label for="extraFeaturesInput">Advanced flags (optional)</label>
                  <textarea id="extraFeaturesInput" placeholder='feature_name=true or JSON object e.g. {"feature":true}'></textarea>
                  <div class="muted-note">For niche toggles. One per line works, or drop in a JSON object.</div>
                </div>
              </div>

              <div class="config-card">
                <h3>Sandbox &amp; Environment</h3>
                <p>Control workspace access, env visibility, and permissions.</p>
                <div class="field">
                  <label for="sandboxModeInput">Sandbox mode</label>
                  <select id="sandboxModeInput">
                    <option value="workspace-write">workspace-write</option>
                    <option value="read-only">read-only</option>
                    <option value="danger-full-access">danger-full-access</option>
                  </select>
                </div>
                <div class="feature-list">
                  <label class="feature-toggle">
                    <input type="checkbox" id="sandboxNetwork" style="width:auto; accent-color: var(--accent);">
                    <div>
                      <div class="feature-title">Allow network access</div>
                      <div class="feature-desc">Let workspace commands reach the internet. Turn off for air-gapped runs.</div>
                    </div>
                  </label>
                  <label class="feature-toggle">
                    <input type="checkbox" id="sandboxTmpdir" style="width:auto; accent-color: var(--accent);">
                    <div>
                      <div class="feature-title">Exclude $TMPDIR</div>
                      <div class="feature-desc">Mount the workspace but skip the host's $TMPDIR to keep temp files private.</div>
                    </div>
                  </label>
                  <label class="feature-toggle">
                    <input type="checkbox" id="sandboxSlashTmp" style="width:auto; accent-color: var(--accent);">
                    <div>
                      <div class="feature-title">Exclude /tmp</div>
                      <div class="feature-desc">Hide /tmp from the sandbox to avoid leaking host temp artifacts.</div>
                    </div>
                  </label>
                </div>
                <div class="field">
                  <label for="writableRootsInput">Writable roots</label>
                  <textarea id="writableRootsInput" placeholder="/path/one&#10;/path/two"></textarea>
                </div>
                <div class="field">
                  <label for="envInheritInput">Shell env inherit</label>
                  <input id="envInheritInput" type="text" placeholder="safe | none | full">
                </div>
                <div class="field">
                  <label for="envIncludeInput">Include only</label>
                  <textarea id="envIncludeInput" placeholder="PATH&#10;HOME"></textarea>
                </div>
                <div class="field">
                  <label for="envExcludeInput">Exclude patterns</label>
                  <textarea id="envExcludeInput" placeholder="AWS_*&#10;AZURE_*"></textarea>
                </div>
                <div class="field">
                  <label for="envSetInput">Set env (key=value per line)</label>
                  <textarea id="envSetInput" placeholder="PATH=/usr/bin&#10;MY_FLAG=1"></textarea>
                </div>
                <label class="feature-toggle" style="margin-top:6px;">
                  <input type="checkbox" id="ignoreDefaultExcludesInput" style="width:auto; accent-color: var(--accent);">
                  <div>
                    <div class="feature-title">Ignore default env excludes</div>
                    <div class="feature-desc">Skip the built-in env blacklist (AWS_*, etc.); only the filters you set above will apply.</div>
                  </div>
                </label>
              </div>

              <div class="config-card">
                <h3>Profiles</h3>
                <p>Per-profile overrides for CLI <code>--profile</code>.</p>
                <div class="row-actions">
                  <button type="button" id="addProfileBtn" class="ghost tiny-btn">+ Add profile</button>
                  <span class="muted-note">Model / provider / approval / sandbox / reasoning.</span>
                </div>
                <div id="profileRows" class="list-rows"></div>
              </div>

              <div class="config-card">
                <h3>MCP &amp; Telemetry</h3>
                <p>Wire Codex-Coordinator memory MCP or other servers, plus OTEL.</p>
                <div class="row-actions" style="align-items:center;">
                  <label class="toggle state-toggle" style="display:inline-flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="orchestratorMcpToggle">
                    <span class="track"><span class="thumb"></span></span>
                    <span class="toggle-text">codex-orchestrator MCP</span>
                  </label>
                </div>
                <div id="orchestratorMcpSummaryWrap" class="field" style="margin-top:4px;" hidden>
                  <span class="muted-note" style="font-weight:600;">Injected per host</span>
                  <div id="orchestratorMcpSummary" class="mono-block" style="margin-top:6px; font-size:12px; line-height:1.4;"></div>
                  <span class="muted-note">Auth token is the host's API key; rendered per-host on fetch.</span>
                </div>
                <div class="row-actions">
                  <button type="button" id="addMcpBtn" class="ghost tiny-btn">+ Add MCP server</button>
                  <span class="muted-note">Command + args; include your API base if needed.</span>
                </div>
                <details id="mcpAccordion" class="mcp-accordion" hidden>
                  <summary>
                    <span>Configured MCP servers</span>
                    <span class="pill-quiet" id="mcpCount">0</span>
                  </summary>
                  <div id="mcpRows" class="list-rows"></div>
                </details>
                <div class="inline-group">
                  <div class="field">
                    <label for="otelExporterInput">Exporter</label>
                    <select id="otelExporterInput">
                      <option value="none">none</option>
                      <option value="otlp-http">otlp-http</option>
                      <option value="otlp-grpc">otlp-grpc</option>
                    </select>
                  </div>
                  <div class="field">
                    <label for="otelEndpointInput">Endpoint</label>
                    <input id="otelEndpointInput" type="text" placeholder="https://otel.example.com">
                  </div>
                  <div class="field">
                    <label for="otelProtocolInput">Protocol</label>
                    <input id="otelProtocolInput" type="text" placeholder="binary | json">
                  </div>
                </div>
                <div class="field">
                  <label for="otelHeadersInput">Headers (key=value)</label>
                  <textarea id="otelHeadersInput" placeholder='x-otlp-api-key=${OTLP_TOKEN}'></textarea>
                </div>
                <label class="field" style="flex-direction:row; align-items:center; gap:8px;">
                  <input type="checkbox" id="otelLogPromptsInput" style="width:auto; accent-color: var(--accent);">
                  <span>log_user_prompt</span>
                </label>
              </div>

              <div class="config-card">
                <h3>Custom TOML</h3>
                <p>Any additional blocks or overrides appended verbatim.</p>
                <div class="field">
                  <textarea id="customTomlInput" placeholder="# Extra settings&#10;[features]&#10;custom_feature = true"></textarea>
                </div>
              </div>
            </div>

            <div class="config-card" style="margin-top:14px;">
              <div class="preview-actions">
                <div>
                  <h3 style="margin:0;">Rendered config.toml</h3>
                  <p class="tagline">Preview is built via the server renderer so hashes match deployed files.</p>
                </div>
                <div class="row-actions">
                  <button type="button" id="copyPreview" class="ghost tiny-btn">Copy</button>
                  <span class="muted-note" id="previewMeta">—</span>
                </div>
              </div>
              <div id="configPreview" class="mono-block" aria-label="Rendered config.toml">Loading…</div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script src="nav.js?v=2025-12-08-06"></script>
  <script src="config.js?v=2025-12-06-03"></script>
</body>
</html>
